<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Umbramed ‚Äî Proyecto EIC 2026</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg:#f4f4f5; --surface:#ffffff; --border:#e4e4e7; --border2:#d4d4d8;
      --text:#18181b; --muted:#71717a; --green:#16a34a; --red:#ef4444; --blue:#2563eb;
      --font:-apple-system,BlinkMacSystemFont,'Inter','Segoe UI',sans-serif;
    }
    body { font-family:var(--font); background:var(--bg); color:var(--text); font-size:14px; }

    /* ‚îÄ‚îÄ SHARED TOPBAR ‚îÄ‚îÄ */
    .topbar {
      position:sticky; top:0; z-index:100;
      background:var(--surface); border-bottom:1px solid var(--border);
      padding:10px 24px; display:flex; align-items:center; gap:12px;
    }
    .back-btn {
      display:flex; align-items:center; gap:5px;
      font-size:13px; color:var(--muted); cursor:pointer;
      padding:4px 10px; border-radius:5px;
      border:1px solid var(--border); background:var(--bg);
    }
    .back-btn:hover { background:var(--border); color:var(--text); }
    .topbar-label { font-size:13px; color:var(--muted); }

    /* ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ */
    #dashboard { max-width:740px; margin:0 auto; padding:48px 24px; }
    header { margin-bottom:36px; }
    .logo  { display:flex; align-items:center; gap:10px; margin-bottom:8px; }
    .logo-mark { width:34px;height:34px;background:var(--text);color:#fff;border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700; }
    h1 { font-size:20px; font-weight:700; letter-spacing:-0.4px; }
    .sub { color:var(--muted); font-size:13.5px; line-height:1.65; margin-top:4px; }

    .stats { display:grid;grid-template-columns:repeat(3,1fr);gap:1px;background:var(--border);border:1px solid var(--border);border-radius:8px;overflow:hidden;margin-bottom:32px; }
    .stat { background:var(--surface);padding:16px 20px; }
    .stat-label { font-size:11px;color:var(--muted);text-transform:uppercase;letter-spacing:.05em;font-weight:600;margin-bottom:4px; }
    .stat-value { font-size:22px;font-weight:700;letter-spacing:-.5px; }
    .stat-sub   { font-size:12px;color:var(--muted);margin-top:3px;line-height:1.4; }

    .sec-title { font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.06em;color:var(--muted);margin-bottom:8px; }
    .section   { margin-bottom:28px; }
    .card      { background:var(--surface);border:1px solid var(--border);border-radius:8px;overflow:hidden; }

    /* Demo hero card */
    .demo-hero {
      background:var(--text);color:#fff;border-radius:8px;
      padding:24px 24px 20px; margin-bottom:28px;
      cursor:pointer; position:relative; overflow:hidden;
    }
    .demo-hero:hover { background:#27272a; }
    .demo-hero-label { font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.1em;opacity:.5;margin-bottom:10px; }
    .demo-hero-title { font-size:18px;font-weight:700;letter-spacing:-.3px;margin-bottom:6px; }
    .demo-hero-sub   { font-size:13px;opacity:.65;line-height:1.5;max-width:480px; }
    .demo-hero-btn   { display:inline-flex;align-items:center;gap:6px;margin-top:16px;background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.2);padding:7px 14px;border-radius:6px;font-size:13px;font-weight:500; }
    .demo-hero-glow  { position:absolute;right:-20px;top:-20px;width:160px;height:160px;background:rgba(255,255,255,.04);border-radius:50%; }

    /* Doc rows */
    .doc-row { display:flex;align-items:center;gap:14px;padding:13px 18px;border-bottom:1px solid var(--border);cursor:pointer;color:var(--text); }
    .doc-row:last-child { border-bottom:none; }
    .doc-row:hover { background:var(--bg); }
    .doc-row:hover .doc-arrow { opacity:1; }
    .doc-icon { font-size:18px;flex-shrink:0; }
    .doc-info { flex:1; }
    .doc-name { font-size:13.5px;font-weight:500; }
    .doc-desc { font-size:12px;color:var(--muted);margin-top:2px;line-height:1.4; }
    .doc-arrow { color:var(--muted);font-size:14px;opacity:.35;transition:opacity .1s; }

    /* Task rows */
    .task-row { display:flex;align-items:flex-start;gap:12px;padding:11px 18px;border-bottom:1px solid var(--border); }
    .task-row:last-child { border-bottom:none; }
    .tdot { width:8px;height:8px;border-radius:50%;flex-shrink:0;margin-top:5px;border:1.5px solid #d4d4d8;background:#fff; }
    .tdot.done    { background:var(--green);border-color:var(--green); }
    .tdot.urgente { background:var(--red);border-color:var(--red); }
    .ttitle { font-size:13px;font-weight:500; }
    .ttitle.done { text-decoration:line-through;color:var(--muted);font-weight:400; }
    .texp   { font-size:12px;color:var(--muted);margin-top:2px;line-height:1.45; }
    .tfecha { font-size:11px;color:#a1a1aa;margin-top:4px;font-weight:500; }

    /* ‚îÄ‚îÄ GENERIC VIEWER (docs + demo) ‚îÄ‚îÄ */
    #viewer { display:none; min-height:100vh; background:var(--bg); }
    .viewer-body { max-width:720px;margin:0 auto;padding:48px 24px 80px; }

    /* Markdown */
    .prose h1 { font-size:24px;font-weight:700;letter-spacing:-.5px;margin-bottom:8px; }
    .prose h2 { font-size:18px;font-weight:600;margin-top:36px;margin-bottom:10px;padding-bottom:8px;border-bottom:1px solid var(--border); }
    .prose h3 { font-size:15px;font-weight:600;margin-top:24px;margin-bottom:8px; }
    .prose h4 { font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.04em;color:var(--muted);margin-top:16px;margin-bottom:6px; }
    .prose p  { font-size:14px;line-height:1.75;color:#27272a;margin-bottom:14px; }
    .prose ul,.prose ol { padding-left:20px;margin-bottom:14px; }
    .prose li { font-size:14px;line-height:1.75;color:#27272a;margin-bottom:4px; }
    .prose strong { font-weight:600;color:var(--text); }
    .prose blockquote { border-left:3px solid var(--border);padding:8px 16px;margin:16px 0;background:var(--bg);border-radius:0 6px 6px 0; }
    .prose blockquote p { margin-bottom:0;color:var(--muted); }
    .prose code { font-family:'SF Mono','Fira Code',monospace;font-size:12.5px;background:var(--bg);border:1px solid var(--border);border-radius:3px;padding:1px 5px; }
    .prose pre  { background:var(--bg);border:1px solid var(--border);border-radius:6px;padding:14px 16px;overflow-x:auto;margin-bottom:16px; }
    .prose pre code { border:none;background:none;padding:0; }
    .prose table { width:100%;border-collapse:collapse;margin-bottom:16px;font-size:13px; }
    .prose th { background:var(--bg);border:1px solid var(--border);padding:7px 12px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.04em;color:var(--muted); }
    .prose td { border:1px solid var(--border);padding:7px 12px;vertical-align:top; }
    .prose hr { border:none;border-top:1px solid var(--border);margin:28px 0; }
    .prose a  { color:var(--text);text-decoration:underline;text-decoration-color:var(--border); }

    /* ‚îÄ‚îÄ UMBRAMED APP DEMO ‚îÄ‚îÄ */
    #demo-app { display:none; height:calc(100vh - 45px); overflow:hidden; }

    .app-shell { display:flex; height:100%; }

    /* App sidebar */
    .app-sidebar {
      width:200px;flex-shrink:0;background:var(--surface);
      border-right:1px solid var(--border);display:flex;flex-direction:column;
      overflow-y:auto;
    }
    .app-brand { padding:14px 16px 12px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:8px; }
    .app-brand-mark { width:26px;height:26px;background:var(--text);color:#fff;border-radius:5px;display:flex;align-items:center;justify-content:center;font-size:10px;font-weight:700; }
    .app-brand-name { font-size:13px;font-weight:700; }
    .app-brand-ver  { font-size:10px;color:var(--muted); }

    .app-nav { padding:8px 6px; }
    .app-nav-label { font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.06em;color:var(--muted);padding:6px 10px 4px; }
    .app-nav-item {
      display:flex;align-items:center;gap:8px;padding:7px 10px;
      border-radius:5px;cursor:pointer;color:var(--muted);font-size:13px;
      transition:background .1s,color .1s;
    }
    .app-nav-item:hover   { background:var(--bg);color:var(--text); }
    .app-nav-item.active  { background:var(--bg);color:var(--text);font-weight:500; }
    .app-nav-item svg { width:14px;height:14px;flex-shrink:0; }
    .app-nav-badge { margin-left:auto;background:var(--red);color:#fff;font-size:10px;font-weight:700;padding:1px 5px;border-radius:9999px; }

    /* App main */
    .app-main { flex:1;display:flex;flex-direction:column;min-width:0;overflow:hidden; }

    /* App topbar */
    .app-topbar {
      background:var(--surface);border-bottom:1px solid var(--border);
      padding:9px 18px;display:flex;align-items:center;gap:10px;flex-shrink:0;
    }
    .app-topbar-title { font-weight:600;font-size:14px; }
    .app-topbar-right { margin-left:auto;display:flex;gap:8px;align-items:center; }
    .ai-badge { background:#f0fdf4;border:1px solid #bbf7d0;color:var(--green);font-size:11px;font-weight:600;padding:2px 8px;border-radius:9999px;display:flex;align-items:center;gap:3px; }
    .ai-badge::before { content:'‚óè';font-size:7px; }

    /* App panels */
    .app-panel { display:none; flex:1; overflow-y:auto; }
    .app-panel.active { display:block; }

    /* ‚îÄ‚îÄ PANEL: Pacientes ‚îÄ‚îÄ */
    .patient-search {
      padding:12px 18px;border-bottom:1px solid var(--border);
      background:var(--surface);display:flex;gap:8px;
    }
    .search-box {
      flex:1;border:1px solid var(--border);border-radius:6px;
      padding:7px 12px;font-size:13px;outline:none;background:var(--bg);
      font-family:var(--font);color:var(--text);
    }
    .search-box:focus { border-color:var(--border2); background:#fff; }
    .filter-btn { border:1px solid var(--border);background:var(--bg);border-radius:6px;padding:7px 12px;font-size:12px;cursor:pointer;color:var(--muted);font-family:var(--font); }
    .filter-btn:hover { background:var(--surface);color:var(--text); }

    .patient-list-header {
      display:grid;grid-template-columns:1fr 120px 90px 90px 80px;
      padding:6px 18px;background:var(--bg);border-bottom:1px solid var(--border);
      font-size:11px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:.04em;
    }
    .patient-row {
      display:grid;grid-template-columns:1fr 120px 90px 90px 80px;
      padding:10px 18px;border-bottom:1px solid var(--border);
      cursor:pointer;align-items:center;
    }
    .patient-row:hover { background:var(--bg); }
    .patient-row.selected { background:#f0f9ff; }
    .p-name { font-size:13px;font-weight:500; }
    .p-meta { font-size:12px;color:var(--muted); }
    .ptag {
      display:inline-flex;align-items:center;font-size:11px;font-weight:500;
      padding:2px 8px;border-radius:9999px;
    }
    .ptag.pend  { background:#fef3c7;color:#b45309;border:1px solid #fde68a; }
    .ptag.ok    { background:#f0fdf4;color:#15803d;border:1px solid #bbf7d0; }
    .ptag.alert { background:#fef2f2;color:#b91c1c;border:1px solid #fecaca; }
    .ptag.nueva { background:#eff6ff;color:#1d4ed8;border:1px solid #bfdbfe; }

    /* ‚îÄ‚îÄ PANEL: Detalle paciente ‚îÄ‚îÄ */
    #panel-paciente { background:var(--bg); }
    .patient-detail-header {
      background:var(--surface);border-bottom:1px solid var(--border);
      padding:16px 20px;display:flex;align-items:center;gap:14px;
    }
    .patient-avatar {
      width:42px;height:42px;border-radius:50%;background:var(--border);
      display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;
    }
    .patient-detail-name { font-size:16px;font-weight:600; }
    .patient-detail-meta { font-size:12px;color:var(--muted); }
    .detail-back { font-size:12px;color:var(--muted);cursor:pointer;margin-right:4px; }
    .detail-back:hover { color:var(--text); }

    .detail-grid { display:grid;grid-template-columns:1fr 300px;gap:12px;padding:12px;align-items:start; }

    .detail-card { background:var(--surface);border:1px solid var(--border);border-radius:8px;overflow:hidden; }
    .detail-card-title {
      padding:10px 14px;border-bottom:1px solid var(--border);
      font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.05em;color:var(--muted);
      display:flex;align-items:center;justify-content:space-between;
    }
    .detail-section { padding:12px 14px;border-bottom:1px solid var(--border); }
    .detail-section:last-child { border-bottom:none; }
    .ds-label { font-size:11px;color:var(--muted);font-weight:500;margin-bottom:4px; }
    .ds-value { font-size:13px;font-weight:500; }

    /* AI suggestion box */
    .ai-box {
      background:#f0fdf4;border:1px solid #bbf7d0;border-radius:8px;
      padding:12px 14px;margin:12px;
    }
    .ai-box-title { font-size:11px;font-weight:700;color:var(--green);text-transform:uppercase;letter-spacing:.05em;margin-bottom:6px;display:flex;align-items:center;gap:5px; }
    .ai-box-title::before { content:'‚ú¶';font-size:9px; }
    .ai-action { display:flex;align-items:center;gap:8px;padding:7px 0;border-bottom:1px solid #bbf7d0; }
    .ai-action:last-child { border-bottom:none;padding-bottom:0; }
    .ai-action-icon { font-size:14px; }
    .ai-action-text { font-size:12.5px;flex:1;line-height:1.4; }
    .ai-action-text strong { color:var(--text);font-weight:600; }
    .ai-btn { font-size:11.5px;font-weight:600;padding:3px 10px;border-radius:5px;border:none;cursor:pointer;background:var(--green);color:#fff;white-space:nowrap;font-family:var(--font); }
    .ai-btn:hover { background:#15803d; }
    .ai-btn.outline { background:#fff;color:var(--green);border:1px solid #bbf7d0; }

    /* ‚îÄ‚îÄ PANEL: Recetas ‚îÄ‚îÄ */
    .recetas-list { padding:12px; }
    .receta-card { background:var(--surface);border:1px solid var(--border);border-radius:8px;margin-bottom:8px;overflow:hidden; }
    .receta-header { padding:10px 14px;display:flex;align-items:center;gap:10px; }
    .receta-drug { font-size:13px;font-weight:600;flex:1; }
    .receta-body { padding:0 14px 12px;display:grid;grid-template-columns:repeat(3,1fr);gap:8px; }
    .receta-field label { font-size:10px;color:var(--muted);text-transform:uppercase;font-weight:600;letter-spacing:.04em;display:block;margin-bottom:2px; }
    .receta-field span  { font-size:13px;font-weight:500; }
    .renew-bar {
      background:var(--bg);border-top:1px solid var(--border);padding:10px 14px;
      display:flex;align-items:center;gap:10px;
    }
    .renew-info { font-size:12px;color:var(--muted);flex:1; }
    .btn-renew { background:var(--text);color:#fff;border:none;border-radius:5px;padding:6px 14px;font-size:12.5px;font-weight:600;cursor:pointer;font-family:var(--font); }
    .btn-renew:hover { background:#27272a; }
    .btn-renew.done { background:var(--green); cursor:default; }
    .btn-secondary { background:var(--bg);color:var(--muted);border:1px solid var(--border);border-radius:5px;padding:6px 12px;font-size:12px;cursor:pointer;font-family:var(--font); }

    /* ‚îÄ‚îÄ PANEL: Nota cl√≠nica ‚îÄ‚îÄ */
    .nota-wrap { padding:12px;display:flex;flex-direction:column;gap:10px; }
    .nota-section { background:var(--surface);border:1px solid var(--border);border-radius:8px;overflow:hidden; }
    .nota-section-title { padding:10px 14px;border-bottom:1px solid var(--border);font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.05em;color:var(--muted);display:flex;align-items:center;gap:6px; }
    .nota-section-title .auto-tag { background:#eff6ff;color:#2563eb;border:1px solid #bfdbfe;padding:1px 6px;border-radius:9999px;font-size:10px;font-weight:600; }
    .nota-textarea {
      width:100%;padding:10px 14px;border:none;outline:none;resize:none;
      font-size:13.5px;line-height:1.65;color:var(--text);font-family:var(--font);
      min-height:80px;background:transparent;
    }
    .nota-actions { padding:8px 14px;background:var(--bg);border-top:1px solid var(--border);display:flex;gap:8px;align-items:center; }
    .nota-actions .auto-info { font-size:11.5px;color:var(--muted);flex:1; }

    /* ‚îÄ‚îÄ PANEL: Dashboard app ‚îÄ‚îÄ */
    .dash-grid { display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px;padding:12px 12px 0; }
    .dash-stat { background:var(--surface);border:1px solid var(--border);border-radius:7px;padding:12px 14px; }
    .ds-n { font-size:20px;font-weight:700;letter-spacing:-.5px; }
    .ds-l { font-size:11px;color:var(--muted);font-weight:500;margin-bottom:4px; }
    .ds-s { font-size:11px;color:var(--muted);margin-top:3px; }
    .today-list { padding:12px; }
    .today-title { font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:.05em;color:var(--muted);margin-bottom:8px; }
    .today-card { background:var(--surface);border:1px solid var(--border);border-radius:7px;padding:11px 14px;margin-bottom:6px;display:flex;align-items:center;gap:10px;cursor:pointer; }
    .today-card:hover { background:var(--bg); }
    .tc-icon { font-size:18px; }
    .tc-info { flex:1; }
    .tc-title { font-size:13px;font-weight:500; }
    .tc-sub   { font-size:12px;color:var(--muted);margin-top:1px; }
    .tc-action { font-size:12px;color:var(--blue);font-weight:500; }

    /* ‚îÄ‚îÄ PANEL: Firma masiva ‚îÄ‚îÄ */
    .firma-banner { background:#fefce8;border-bottom:1px solid #fef08a;padding:10px 18px;display:flex;align-items:center;gap:10px;font-size:13px; }
    .firma-banner strong { color:#854d0e; }
    .firma-row { display:flex;align-items:center;gap:12px;padding:11px 18px;border-bottom:1px solid var(--border); }
    .firma-check { width:16px;height:16px;border:1.5px solid var(--border2);border-radius:3px;cursor:pointer;display:flex;align-items:center;justify-content:center;font-size:10px;flex-shrink:0;background:#fff; }
    .firma-check.checked { background:var(--text);border-color:var(--text);color:#fff; }
    .firma-info { flex:1; }
    .firma-name { font-size:13px;font-weight:500; }
    .firma-meta { font-size:12px;color:var(--muted);margin-top:1px; }
    .firma-bottom { padding:12px 18px;background:var(--surface);border-top:1px solid var(--border);display:flex;gap:8px;align-items:center; }
    .firma-bottom .count { font-size:12px;color:var(--muted);flex:1; }
    .btn-firmar { background:var(--text);color:#fff;border:none;border-radius:6px;padding:8px 18px;font-size:13px;font-weight:600;cursor:pointer;font-family:var(--font); }
    .btn-firmar:hover { background:#27272a; }

    /* loading */
    .loading { text-align:center;padding:60px 0;color:var(--muted);font-size:13px; }

    @media(max-width:600px) {
      .stats { grid-template-columns:1fr; }
      .app-sidebar { display:none; }
      .patient-list-header,.patient-row { grid-template-columns:1fr 80px 70px; }
    }
  </style>
</head>
<body>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="dashboard">
  <div style="max-width:740px;margin:0 auto;padding:48px 24px">

    <header>
      <div class="logo">
        <div class="logo-mark">UM</div>
        <h1>Umbramed ‚Äî Proyecto EIC 2026</h1>
      </div>
      <p class="sub">Umbramed es un asistente de IA para m√©dicos de atenci√≥n primaria. Convierte las <strong>2 horas diarias de trabajo administrativo</strong> (recetas, informes, derivaciones) en 10 minutos supervisados. Estamos solicitando hasta <strong>‚Ç¨17,5M de financiaci√≥n europea</strong> para validarlo con los 6.500 pacientes de Valerio.</p>
    </header>

    <!-- Stats -->
    <div class="stats">
      <div class="stat">
        <div class="stat-label">Financiaci√≥n objetivo</div>
        <div class="stat-value">‚Ç¨2,5M</div>
        <div class="stat-sub">Grant EIC + opci√≥n ‚Ç¨15M equity</div>
      </div>
      <div class="stat">
        <div class="stat-label">Fecha l√≠mite</div>
        <div class="stat-value">Oct 2026</div>
        <div class="stat-sub">~245 d√≠as para entregar la solicitud</div>
      </div>
      <div class="stat">
        <div class="stat-label">Tu papel, Valerio</div>
        <div class="stat-value">IP del estudio</div>
        <div class="stat-sub">Sin m√©dico visible: probabilidad baja del 20% al 5%</div>
      </div>
    </div>

    <!-- Demo hero -->
    <div class="demo-hero" onclick="openDemo()">
      <div class="demo-hero-glow"></div>
      <div class="demo-hero-label">Demo interactiva del producto</div>
      <div class="demo-hero-title">As√≠ funciona Umbramed ‚Äî pru√©balo ahora</div>
      <div class="demo-hero-sub">Navega por el software real: lista de pacientes, renovaci√≥n de recetas con IA, notas cl√≠nicas autom√°ticas y firma masiva. Exactamente lo que ver√°n los evaluadores del EIC.</div>
      <div class="demo-hero-btn">‚ñ∂ Abrir demo &nbsp;‚Äî&nbsp; Umbramed v1.0</div>
    </div>

    <!-- Documents -->
    <div class="section">
      <div class="sec-title">Documentos del proyecto</div>
      <div class="card">
        <div class="doc-row" onclick="openDoc('public/VALERIO_PLAN_ACCION_EJECUTIVO.md','Plan de Acci√≥n')">
          <span class="doc-icon">üó∫Ô∏è</span>
          <div class="doc-info">
            <div class="doc-name">Plan de Acci√≥n ‚Äî Qu√© hay que hacer y cu√°ndo</div>
            <div class="doc-desc">Convocatorias, deadlines y lo que necesitamos de Valerio, paso a paso.</div>
          </div>
          <span class="doc-arrow">‚Üí</span>
        </div>
        <div class="doc-row" onclick="openDoc('public/VALERIO_VIDEO_SCRIPT_EIC.md','Gui√≥n del V√≠deo EIC')">
          <span class="doc-icon">üé¨</span>
          <div class="doc-info">
            <div class="doc-name">Gui√≥n del V√≠deo ‚Äî Lo que Valerio dice en c√°mara</div>
            <div class="doc-desc">El v√≠deo de 3 min vale el 50% de la puntuaci√≥n EIC. Aqu√≠ est√° el gui√≥n exacto.</div>
          </div>
          <span class="doc-arrow">‚Üí</span>
        </div>
        <div class="doc-row" onclick="openDoc('public/VIDEO_SCRIPT_UMBRAMED_ES.md','Gui√≥n en Espa√±ol')">
          <span class="doc-icon">üá™üá∏</span>
          <div class="doc-info">
            <div class="doc-name">Gui√≥n del V√≠deo en Espa√±ol (versi√≥n completa)</div>
            <div class="doc-desc">Versi√≥n extendida con contexto cl√≠nico para los evaluadores europeos.</div>
          </div>
          <span class="doc-arrow">‚Üí</span>
        </div>
        <div class="doc-row" onclick="openDoc('public/VIDEO_SCRIPT_UMBRAMED_EN.md','Script in English')">
          <span class="doc-icon">üåê</span>
          <div class="doc-info">
            <div class="doc-name">Video Script in English</div>
            <div class="doc-desc">La versi√≥n oficial en ingl√©s (idioma requerido por la EIC).</div>
          </div>
          <span class="doc-arrow">‚Üí</span>
        </div>
        <div class="doc-row" onclick="openDoc('public/CLINICAL_PROTOCOL_UMBRAMED.md','Protocolo Cl√≠nico')">
          <span class="doc-icon">üè•</span>
          <div class="doc-info">
            <div class="doc-name">Protocolo Cl√≠nico ‚Äî C√≥mo validamos con tus pacientes</div>
            <div class="doc-desc">Dise√±o del estudio con los 6.500 pacientes de Valerio en el SAS.</div>
          </div>
          <span class="doc-arrow">‚Üí</span>
        </div>
        <div class="doc-row" onclick="openDoc('public/UMBRAMED_Clinical_Protocol_v1.2.md','Protocolo v1.2')">
          <span class="doc-icon">üî¨</span>
          <div class="doc-info">
            <div class="doc-name">Protocolo Cl√≠nico v1.2 ‚Äî Versi√≥n actualizada</div>
            <div class="doc-desc">Criterios de inclusi√≥n, endpoints primarios y an√°lisis estad√≠stico.</div>
          </div>
          <span class="doc-arrow">‚Üí</span>
        </div>
      </div>
    </div>

    <!-- Tasks -->
    <div class="section">
      <div class="sec-title">Tareas pendientes ‚Äî Lo que necesitamos ahora</div>
      <div class="card">
        <div class="task-row"><div class="tdot done"></div><div><div class="ttitle done">Protocolo cl√≠nico v1.2 completado</div></div></div>
        <div class="task-row"><div class="tdot done"></div><div><div class="ttitle done">Guiones del v√≠deo ES + EN redactados</div></div></div>
        <div class="task-row">
          <div class="tdot urgente"></div>
          <div>
            <div class="ttitle">Grabar el v√≠deo de presentaci√≥n (3 minutos)</div>
            <div class="texp">Este v√≠deo es lo m√°s importante de la solicitud. Los evaluadores lo ven antes que nada. Valerio graba en bata blanca, en consulta, con el gui√≥n que ya est√° listo.</div>
            <div class="tfecha">‚ö†Ô∏è Urgente ‚Äî antes de marzo 2026</div>
          </div>
        </div>
        <div class="task-row">
          <div class="tdot urgente"></div>
          <div>
            <div class="ttitle">Arrancar el piloto cl√≠nico en Cl√≠nica Vistahermosa</div>
            <div class="texp">Necesitamos datos reales de pacientes para la solicitud. M√≠nimo 50 casos antes de mayo para tener resultados preliminares.</div>
            <div class="tfecha">‚ö†Ô∏è Cr√≠tico ‚Äî datos antes de mayo 2026</div>
          </div>
        </div>
        <div class="task-row">
          <div class="tdot"></div>
          <div>
            <div class="ttitle">Cartas de apoyo de 2 hospitales</div>
            <div class="texp">Dos jefes de servicio que avalen el proyecto por escrito. No hay compromiso econ√≥mico, solo validaci√≥n del problema.</div>
            <div class="tfecha">Mayo 2026</div>
          </div>
        </div>
        <div class="task-row">
          <div class="tdot"></div>
          <div>
            <div class="ttitle">Modelo financiero a 5 a√±os</div>
            <div class="texp">Proyecci√≥n de cu√°ntos m√©dicos pueden usar Umbramed, a qu√© precio y en qu√© pa√≠ses. Sami lo lidera.</div>
            <div class="tfecha">Marzo ‚Äì Abril 2026</div>
          </div>
        </div>
        <div class="task-row">
          <div class="tdot"></div>
          <div>
            <div class="ttitle">Borrador de la solicitud EIC (Paso 1)</div>
            <div class="texp">Formulario corto de 10 p√°ginas. Si pasa, accedemos al Paso 2 con el business plan completo.</div>
            <div class="tfecha">Julio 2026</div>
          </div>
        </div>
      </div>
    </div>

    <div style="text-align:center;color:#a1a1aa;font-size:11.5px;padding-bottom:24px;">
      Umbramed ¬∑ Proyecto EIC 2026 ¬∑ Febrero 2026
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VIEWER (docs) ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="viewer">
  <div class="topbar">
    <span class="back-btn" onclick="closeView()">‚Üê Volver</span>
    <span class="topbar-label" id="viewer-title"></span>
  </div>
  <div class="viewer-body">
    <div class="prose" id="viewer-content"><div class="loading">Cargando‚Ä¶</div></div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DEMO APP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="demo-wrapper">
  <!-- topbar -->
  <div class="topbar" id="demo-topbar" style="display:none">
    <span class="back-btn" onclick="closeDemo()">‚Üê Volver</span>
    <span class="topbar-label">Demo ‚Äî Umbramed v1.0</span>
    <div style="margin-left:auto"><span class="ai-badge">IA activa</span></div>
  </div>

  <!-- app shell -->
  <div id="demo-app">
    <div class="app-shell">

      <!-- Sidebar -->
      <nav class="app-sidebar">
        <div class="app-brand">
          <div class="app-brand-mark">UM</div>
          <div>
            <div class="app-brand-name">Umbramed</div>
            <div class="app-brand-ver">v1.0 ‚Äî Demo</div>
          </div>
        </div>
        <div class="app-nav">
          <div class="app-nav-label">Principal</div>
          <div class="app-nav-item active" id="nav-inicio"    onclick="showPanel('inicio')">
            <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="1" y="1" width="6" height="6" rx="1"/><rect x="9" y="1" width="6" height="6" rx="1"/><rect x="1" y="9" width="6" height="6" rx="1"/><rect x="9" y="9" width="6" height="6" rx="1"/></svg>
            Inicio
          </div>
          <div class="app-nav-item" id="nav-pacientes" onclick="showPanel('pacientes')">
            <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="6" cy="5" r="2.5"/><path d="M1 13c0-2.76 2.24-5 5-5h1M12 10v4M14 12h-4"/></svg>
            Pacientes
          </div>
          <div class="app-nav-item" id="nav-recetas" onclick="showPanel('recetas')">
            <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M3 1h7l3 3v11H3V1z"/><path d="M10 1v3h3M5 7h6M5 10h4"/></svg>
            Recetas
            <span class="app-nav-badge">14</span>
          </div>
          <div class="app-nav-item" id="nav-firma" onclick="showPanel('firma')">
            <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 12l2-2 8-8 2 2-8 8-2 0 0-2zM12 4l-2-2"/></svg>
            Firma masiva
            <span class="app-nav-badge">8</span>
          </div>
          <div class="app-nav-item" id="nav-nota" onclick="showPanel('nota')">
            <svg viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2 2h12v10l-3 3H2V2z"/><path d="M5 6h6M5 9h4M11 12v-3h3"/></svg>
            Nota cl√≠nica
          </div>
        </div>
      </nav>

      <!-- Main -->
      <div class="app-main">
        <div class="app-topbar">
          <span class="app-topbar-title" id="panel-title">Inicio ‚Äî Resumen del d√≠a</span>
          <div class="app-topbar-right">
            <span style="font-size:12px;color:var(--muted)">Dr. Valerio Trigos</span>
            <div style="width:28px;height:28px;border-radius:50%;background:var(--text);color:#fff;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;">VT</div>
          </div>
        </div>

        <!-- PANEL: Inicio -->
        <div class="app-panel active" id="panel-inicio">
          <div class="dash-grid">
            <div class="dash-stat">
              <div class="ds-l">Recetas pendientes</div>
              <div class="ds-n">14</div>
              <div class="ds-s">8 pre-aprobadas por IA</div>
            </div>
            <div class="dash-stat">
              <div class="ds-l">Tiempo ahorrado hoy</div>
              <div class="ds-n">1h 42m</div>
              <div class="ds-s">vs. proceso manual</div>
            </div>
            <div class="dash-stat">
              <div class="ds-l">Pacientes atendidos</div>
              <div class="ds-n">23</div>
              <div class="ds-s">de 28 citados</div>
            </div>
          </div>
          <div class="today-list">
            <div class="today-title">Acciones de hoy que Umbramed ha preparado</div>
            <div class="today-card" onclick="showPanel('recetas')">
              <span class="tc-icon">üíä</span>
              <div class="tc-info">
                <div class="tc-title">8 recetas listas para revisar y firmar</div>
                <div class="tc-sub">IA ha verificado interacciones y dosis ‚Äî pendiente tu firma</div>
              </div>
              <span class="tc-action">Revisar ‚Üí</span>
            </div>
            <div class="today-card" onclick="showPanel('firma')">
              <span class="tc-icon">‚úçÔ∏è</span>
              <div class="tc-info">
                <div class="tc-title">Firma masiva disponible ‚Äî 8 documentos</div>
                <div class="tc-sub">Recetas e informes listos para firmar de un solo clic</div>
              </div>
              <span class="tc-action">Firmar ‚Üí</span>
            </div>
            <div class="today-card" onclick="showPanel('nota')">
              <span class="tc-icon">üìù</span>
              <div class="tc-info">
                <div class="tc-title">Nota cl√≠nica de √∫ltima consulta ‚Äî borrador listo</div>
                <div class="tc-sub">Umbramed ha generado el borrador. Solo revisa y confirma.</div>
              </div>
              <span class="tc-action">Revisar ‚Üí</span>
            </div>
            <div class="today-card" onclick="showPanel('pacientes')">
              <span class="tc-icon">üîî</span>
              <div class="tc-info">
                <div class="tc-title">3 pacientes con alertas cl√≠nicas detectadas por IA</div>
                <div class="tc-sub">Valores fuera de rango en anal√≠ticas recientes</div>
              </div>
              <span class="tc-action">Ver ‚Üí</span>
            </div>
          </div>
        </div>

        <!-- PANEL: Pacientes -->
        <div class="app-panel" id="panel-pacientes">
          <div class="patient-search">
            <input class="search-box" placeholder="Buscar paciente por nombre o NHC‚Ä¶" oninput="filterPatients(this.value)" />
            <select class="filter-btn" onchange="filterPatients('')">
              <option>Todos</option>
              <option>Con alertas</option>
              <option>Receta pendiente</option>
            </select>
          </div>
          <div class="patient-list-header">
            <div>Paciente</div><div>√öltima visita</div><div>Estado</div><div>Receta</div><div></div>
          </div>
          <div id="patient-list-body"></div>
        </div>

        <!-- PANEL: Detalle paciente -->
        <div class="app-panel" id="panel-paciente">
          <div class="patient-detail-header">
            <span class="detail-back" onclick="showPanel('pacientes')">‚Üê Pacientes</span>
            <div class="patient-avatar" id="det-avatar">üë§</div>
            <div>
              <div class="patient-detail-name" id="det-name">‚Äî</div>
              <div class="patient-detail-meta" id="det-meta">‚Äî</div>
            </div>
          </div>
          <div class="detail-grid">
            <div>
              <div class="detail-card" style="margin-bottom:10px">
                <div class="detail-card-title">Datos cl√≠nicos</div>
                <div class="detail-section"><div class="ds-label">Diagn√≥stico principal</div><div class="ds-value" id="det-diag">‚Äî</div></div>
                <div class="detail-section"><div class="ds-label">Medicaci√≥n actual</div><div class="ds-value" id="det-med">‚Äî</div></div>
                <div class="detail-section"><div class="ds-label">√öltima anal√≠tica</div><div class="ds-value" id="det-anal">‚Äî</div></div>
              </div>
              <div class="detail-card">
                <div class="detail-card-title">Historial reciente</div>
                <div class="detail-section" style="font-size:12.5px;color:var(--muted);line-height:1.6" id="det-historial">‚Äî</div>
              </div>
            </div>
            <div>
              <div class="ai-box">
                <div class="ai-box-title">Sugerencias de Umbramed IA</div>
                <div id="det-ai-actions"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- PANEL: Recetas -->
        <div class="app-panel" id="panel-recetas">
          <div class="recetas-list" id="recetas-list-body"></div>
        </div>

        <!-- PANEL: Nota cl√≠nica -->
        <div class="app-panel" id="panel-nota">
          <div class="nota-wrap">
            <div class="nota-section">
              <div class="nota-section-title">
                Motivo de consulta
                <span class="auto-tag">manual</span>
              </div>
              <textarea class="nota-textarea" placeholder="Escribe el motivo de la consulta‚Ä¶">Paciente acude por revisi√≥n de patolog√≠a cr√≥nica ‚Äî HTA y DM2.</textarea>
            </div>
            <div class="nota-section">
              <div class="nota-section-title">
                Anamnesis y exploraci√≥n
                <span class="auto-tag">IA ‚Äî generado</span>
              </div>
              <textarea class="nota-textarea" style="min-height:110px">Paciente de 67 a√±os con HTA de larga evoluci√≥n y DM2 en tratamiento con Metformina 850mg y Enalapril 10mg. Refiere buen cumplimiento terap√©utico. TA 142/88 mmHg, FC 74 lpm. Glucemia capilar 118 mg/dL. Sin s√≠ntomas de descompensaci√≥n.</textarea>
              <div class="nota-actions">
                <span class="auto-info">‚ú¶ Generado por IA a partir del historial del paciente ‚Äî revisa antes de guardar</span>
                <button class="btn-secondary" onclick="regenNota()">Regenerar</button>
                <button class="btn-renew" onclick="this.textContent='‚úì Guardado';this.classList.add('done')">Confirmar nota</button>
              </div>
            </div>
            <div class="nota-section">
              <div class="nota-section-title">
                Plan terap√©utico
                <span class="auto-tag">IA ‚Äî sugerido</span>
              </div>
              <textarea class="nota-textarea">Mantener tratamiento actual. Reforzar adherencia diet√©tica. Control en 3 meses o antes si TA &gt; 160/100. Solicitar HbA1c si no disponible en √∫ltimos 3 meses.</textarea>
              <div class="nota-actions">
                <span class="auto-info">‚ú¶ Basado en gu√≠as cl√≠nicas ESH/ESC 2023</span>
                <button class="btn-renew" onclick="this.textContent='‚úì Aprobado';this.classList.add('done')">Aprobar plan</button>
              </div>
            </div>
          </div>
        </div>

        <!-- PANEL: Firma masiva -->
        <div class="app-panel" id="panel-firma">
          <div class="firma-banner">
            <span>‚ö°</span>
            <span><strong>8 documentos listos para firmar.</strong> Umbramed los ha verificado ‚Äî ninguno tiene alertas de seguridad.</span>
          </div>
          <div id="firma-list-body"></div>
          <div class="firma-bottom">
            <span class="count" id="firma-count">0 seleccionados</span>
            <button class="btn-secondary" onclick="selectAllFirma()">Seleccionar todo</button>
            <button class="btn-firmar" onclick="firmarTodo()">Firmar seleccionados</button>
          </div>
        </div>

      </div><!-- /app-main -->
    </div><!-- /app-shell -->
  </div><!-- /demo-app -->
</div><!-- /demo-wrapper -->

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NAV ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function show(id) {
  ['dashboard','viewer','demo-app','demo-topbar'].forEach(i => {
    const el = document.getElementById(i);
    if(el) el.style.display = 'none';
  });
  document.getElementById(id).style.display = 'block';
  window.scrollTo(0,0);
}

function openDoc(path, title) {
  show('viewer');
  document.getElementById('viewer-title').textContent = title;
  document.getElementById('viewer-content').innerHTML = '<div class="loading">Cargando‚Ä¶</div>';
  fetch(path).then(r=>r.text()).then(md=>{
    document.getElementById('viewer-content').innerHTML = marked.parse(md);
  }).catch(()=>{
    document.getElementById('viewer-content').innerHTML = '<div class="loading">No se pudo cargar el documento.</div>';
  });
}

function closeView() {
  show('dashboard');
}

function openDemo() {
  document.getElementById('dashboard').style.display = 'none';
  document.getElementById('demo-topbar').style.display = 'flex';
  document.getElementById('demo-app').style.display = 'block';
  window.scrollTo(0,0);
  initDemo();
}

function closeDemo() {
  show('dashboard');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DEMO DATA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const patients = [
  { id:1, name:'Garc√≠a L√≥pez, Mar√≠a',      age:67, nhc:'SAS-441823', diag:'HTA + DM2',                 ultima:'Hoy',       estado:'alert', receta:'Pendiente', med:'Metformina 850mg ¬∑ Enalapril 10mg',  anal:'HbA1c 7.8% (ene 2026)', historial:'Revisi√≥n mensual estable. √öltima descompensaci√≥n ago 2025 por incumplimiento.', ai:[{icon:'üíä',text:'<strong>Renovar receta</strong> ‚Äî Metformina 850mg √ó 90 d√≠as',ok:true},{icon:'üìä',text:'<strong>Solicitar HbA1c</strong> ‚Äî √∫ltima hace 3 meses',ok:true},{icon:'‚ö†Ô∏è',text:'<strong>TA elevada</strong> ‚Äî valorar ajuste de Enalapril',ok:false}] },
  { id:2, name:'Rodr√≠guez P√©rez, Antonio', age:54, nhc:'SAS-309712', diag:'EPOC moderado',              ultima:'Ayer',      estado:'pend',  receta:'Pendiente', med:'Salbutamol 100mcg ¬∑ Budesonida 400mcg', anal:'Espirometr√≠a pendiente', historial:'Exacerbaci√≥n leve en diciembre. Buen cumplimiento inhaladores.', ai:[{icon:'üíä',text:'<strong>Renovar inhaladores</strong> ‚Äî √∫ltima renovaci√≥n hace 90 d√≠as',ok:true},{icon:'üî¨',text:'<strong>Solicitar espirometr√≠a</strong> de control',ok:true}] },
  { id:3, name:'Mart√≠nez S√°nchez, Elena',  age:72, nhc:'SAS-518934', diag:'FA + anticoagulaci√≥n',      ultima:'Lun',       estado:'alert', receta:'Pendiente', med:'Apixab√°n 5mg ¬∑ Bisoprolol 2.5mg',       anal:'INR no aplica (NACO)', historial:'Control estable. Sin sangrados. ECG ritmo sinusal en √∫ltima visita.', ai:[{icon:'üíä',text:'<strong>Renovar Apixab√°n</strong> ‚Äî adherencia cr√≠tica en FA',ok:true},{icon:'‚ö†Ô∏è',text:'<strong>Revisar interacci√≥n</strong> con AINE prescrito en urgencias',ok:false}] },
  { id:4, name:'Fern√°ndez Gil, Jos√©',      age:45, nhc:'SAS-221045', diag:'Hiperlipidemia',            ultima:'12 ene',    estado:'ok',    receta:'Al d√≠a',    med:'Atorvastatina 40mg',                    anal:'Col total 198 mg/dL', historial:'Bien controlado. Dieta y ejercicio regular. No fumador.', ai:[{icon:'‚úÖ',text:'Sin acciones pendientes ‚Äî control en 6 meses',ok:true}] },
  { id:5, name:'L√≥pez Torres, Carmen',    age:61, nhc:'SAS-388201', diag:'Hipotiroidismo',            ultima:'5 ene',     estado:'ok',    receta:'Al d√≠a',    med:'Levotiroxina 75mcg',                    anal:'TSH 2.1 mUI/L', historial:'Estable. Control TSH anual programado.', ai:[{icon:'üíä',text:'<strong>Renovar Levotiroxina</strong> pr√≥ximo mes',ok:true}] },
  { id:6, name:'G√≥mez Ruiz, Francisco',   age:78, nhc:'SAS-503467', diag:'Insuficiencia cardiaca FC II',ultima:'Hoy',      estado:'alert', receta:'Pendiente', med:'Furosemida 40mg ¬∑ Carvedilol 6.25mg ¬∑ Ramipril 5mg', anal:'BNP 380 pg/mL (‚Üë)', historial:'Ingreso breve en noviembre por descompensaci√≥n. Alta mejor√≠a.', ai:[{icon:'‚ö†Ô∏è',text:'<strong>BNP elevado</strong> ‚Äî valorar ajuste de Furosemida',ok:false},{icon:'üíä',text:'<strong>Renovar triple terapia</strong> IC',ok:true},{icon:'üìû',text:'<strong>Llamada de seguimiento</strong> recomendada esta semana',ok:true}] },
  { id:7, name:'D√≠az Moreno, Isabel',     age:38, nhc:'SAS-178023', diag:'Asma leve intermitente',    ultima:'20 dic',    estado:'ok',    receta:'Al d√≠a',    med:'Salbutamol 100mcg (a demanda)',          anal:'Pico flujo normal', historial:'Sin crisis en el √∫ltimo a√±o. Buen control ambiental.', ai:[{icon:'‚úÖ',text:'Control en 6 meses. Sin renovaciones urgentes.',ok:true}] },
  { id:8, name:'S√°nchez Vega, Roberto',   age:55, nhc:'SAS-412788', diag:'DM2 + nefropat√≠a leve',     ultima:'Hoy',       estado:'pend',  receta:'Pendiente', med:'Empagliflozina 10mg ¬∑ Losart√°n 50mg',    anal:'FGe 58 mL/min (‚Üì)', historial:'Seguimiento conjunto con Nefrolog√≠a. FGe en descenso leve.', ai:[{icon:'‚ö†Ô∏è',text:'<strong>FGe < 60</strong> ‚Äî revisar dosis Empagliflozina con Nefrolog√≠a',ok:false},{icon:'üíä',text:'<strong>Renovar Losart√°n</strong> ‚Äî protecci√≥n renal confirmada',ok:true}] },
];

const recetas = [
  { drug:'Metformina 850 mg',       dosif:'1 comp. / 12h',    dur:'90 d√≠as', paciente:'Garc√≠a L√≥pez, Mar√≠a',      ai:'sin interacciones', btn:false },
  { drug:'Enalapril 10 mg',         dosif:'1 comp. / 24h',    dur:'90 d√≠as', paciente:'Garc√≠a L√≥pez, Mar√≠a',      ai:'sin interacciones', btn:false },
  { drug:'Furosemida 40 mg',        dosif:'1 comp. / 24h en ayunas', dur:'30 d√≠as', paciente:'G√≥mez Ruiz, Francisco', ai:'revisar K+',   btn:false },
  { drug:'Carvedilol 6,25 mg',      dosif:'1 comp. / 12h',    dur:'30 d√≠as', paciente:'G√≥mez Ruiz, Francisco',   ai:'sin interacciones', btn:false },
  { drug:'Ramipril 5 mg',           dosif:'1 comp. / 24h',    dur:'30 d√≠as', paciente:'G√≥mez Ruiz, Francisco',   ai:'sin interacciones', btn:false },
  { drug:'Apixab√°n 5 mg',           dosif:'1 comp. / 12h con las comidas', dur:'90 d√≠as', paciente:'Mart√≠nez S√°nchez, Elena', ai:'‚ö†Ô∏è interacci√≥n AINE ‚Äî revisar', btn:false },
  { drug:'Empagliflozina 10 mg',    dosif:'1 comp. / 24h',    dur:'90 d√≠as', paciente:'S√°nchez Vega, Roberto',   ai:'‚ö†Ô∏è FGe < 60 ‚Äî confirmar con Nefro', btn:false },
  { drug:'Salbutamol 100 mcg inh.', dosif:'2 puls. en crisis',dur:'90 d√≠as', paciente:'Rodr√≠guez P√©rez, Antonio', ai:'sin interacciones', btn:false },
];

const firmas = [
  { type:'Receta', desc:'Metformina 850mg √ó 90 d√≠as',            pac:'Garc√≠a L√≥pez, Mar√≠a',       ok:true,  checked:false },
  { type:'Receta', desc:'Enalapril 10mg √ó 90 d√≠as',              pac:'Garc√≠a L√≥pez, Mar√≠a',       ok:true,  checked:false },
  { type:'Receta', desc:'Apixab√°n 5mg √ó 90 d√≠as',               pac:'Mart√≠nez S√°nchez, Elena',   ok:false, checked:false },
  { type:'Receta', desc:'Carvedilol 6.25mg √ó 30 d√≠as',          pac:'G√≥mez Ruiz, Francisco',     ok:true,  checked:false },
  { type:'Informe','desc':'Informe de derivaci√≥n a Cardiolog√≠a',  pac:'G√≥mez Ruiz, Francisco',     ok:true,  checked:false },
  { type:'Receta', desc:'Salbutamol 100mcg √ó 90 d√≠as',           pac:'Rodr√≠guez P√©rez, Antonio',  ok:true,  checked:false },
  { type:'Informe','desc':'Nota cl√≠nica revisi√≥n DM2',           pac:'S√°nchez Vega, Roberto',     ok:false, checked:false },
  { type:'Receta', desc:'Levotiroxina 75mcg √ó 90 d√≠as',          pac:'L√≥pez Torres, Carmen',      ok:true,  checked:false },
];

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DEMO INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let demoInited = false;
function initDemo() {
  if(demoInited) return;
  demoInited = true;
  renderPatients(patients);
  renderRecetas();
  renderFirmas();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PANELS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showPanel(name) {
  document.querySelectorAll('.app-panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.app-nav-item').forEach(n=>n.classList.remove('active'));
  const panelMap = { inicio:'inicio', pacientes:'pacientes', recetas:'recetas', firma:'firma', nota:'nota', paciente:'paciente' };
  const titleMap = { inicio:'Inicio ‚Äî Resumen del d√≠a', pacientes:'Pacientes', recetas:'Recetas pendientes', firma:'Firma masiva', nota:'Nota cl√≠nica', paciente:'Detalle paciente' };
  document.getElementById('panel-'+panelMap[name]).classList.add('active');
  document.getElementById('panel-title').textContent = titleMap[name];
  if(document.getElementById('nav-'+name)) document.getElementById('nav-'+name).classList.add('active');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PATIENTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderPatients(list) {
  const colors = { alert:'#fef2f2', ok:'#f0fdf4', pend:'#fefce8', nueva:'#eff6ff' };
  const html = list.map(p=>`
    <div class="patient-row" onclick="openPatient(${p.id})">
      <div><div class="p-name">${p.name}</div><div class="p-meta">${p.age} a√±os ¬∑ ${p.nhc}</div></div>
      <div class="p-meta">${p.ultima}</div>
      <div>${statusTag(p.estado)}</div>
      <div>${recetaTag(p.receta)}</div>
      <div style="text-align:right"><span style="font-size:12px;color:#a1a1aa">Ver ‚Üí</span></div>
    </div>`).join('');
  document.getElementById('patient-list-body').innerHTML = html;
}

function statusTag(s) {
  const m = { alert:['alert','‚ö† Alerta'], ok:['ok','‚úì Estable'], pend:['pend','Pendiente'], nueva:['nueva','Nueva'] };
  const [cls,label] = m[s]||['',''];
  return `<span class="ptag ${cls}">${label}</span>`;
}
function recetaTag(s) {
  if(s==='Al d√≠a') return `<span class="ptag ok">‚úì Al d√≠a</span>`;
  return `<span class="ptag pend">Pendiente</span>`;
}

function filterPatients(q) {
  const filtered = patients.filter(p=>p.name.toLowerCase().includes(q.toLowerCase())||p.diag.toLowerCase().includes(q.toLowerCase()));
  renderPatients(filtered);
}

function openPatient(id) {
  const p = patients.find(x=>x.id===id);
  if(!p) return;
  document.getElementById('det-avatar').textContent = p.name[0];
  document.getElementById('det-name').textContent = p.name;
  document.getElementById('det-meta').textContent = `${p.age} a√±os ¬∑ ${p.nhc} ¬∑ ${p.diag}`;
  document.getElementById('det-diag').textContent = p.diag;
  document.getElementById('det-med').textContent = p.med;
  document.getElementById('det-anal').textContent = p.anal;
  document.getElementById('det-historial').textContent = p.historial;
  document.getElementById('det-ai-actions').innerHTML = p.ai.map(a=>`
    <div class="ai-action">
      <span class="ai-action-icon">${a.icon}</span>
      <span class="ai-action-text">${a.text}</span>
      <button class="ai-btn ${a.ok?'':'outline'}" onclick="this.textContent='‚úì Hecho';this.disabled=true">${a.ok?'Aplicar':'Revisar'}</button>
    </div>`).join('');
  showPanel('paciente');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RECETAS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderRecetas() {
  const html = recetas.map((r,i)=>`
    <div class="receta-card" id="rec-${i}">
      <div class="receta-header">
        <span class="receta-drug">${r.drug}</span>
        <span class="ptag ${r.ai.includes('‚ö†Ô∏è')?'alert':'ok'}" style="font-size:11px">IA: ${r.ai}</span>
      </div>
      <div class="receta-body">
        <div class="receta-field"><label>Posolog√≠a</label><span>${r.dosif}</span></div>
        <div class="receta-field"><label>Duraci√≥n</label><span>${r.dur}</span></div>
        <div class="receta-field"><label>Paciente</label><span style="font-size:12px">${r.paciente}</span></div>
      </div>
      <div class="renew-bar">
        <span class="renew-info">‚ú¶ Umbramed ha revisado interacciones y dosis autom√°ticamente</span>
        <button class="btn-secondary">Editar</button>
        <button class="btn-renew" id="renew-btn-${i}" onclick="renovarReceta(${i})">Renovar</button>
      </div>
    </div>`).join('');
  document.getElementById('recetas-list-body').innerHTML = html;
}

function renovarReceta(i) {
  const btn = document.getElementById('renew-btn-'+i);
  btn.textContent = '‚úì Renovada';
  btn.classList.add('done');
  btn.disabled = true;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FIRMA ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderFirmas() {
  const html = firmas.map((f,i)=>`
    <div class="firma-row">
      <div class="firma-check" id="fcheck-${i}" onclick="toggleFirma(${i})"></div>
      <div class="firma-info">
        <div class="firma-name">${f.desc}</div>
        <div class="firma-meta">${f.type} ¬∑ ${f.pac} ¬∑ ${f.ok?'<span style="color:var(--green)">‚úì verificado por IA</span>':'<span style="color:var(--red)">‚ö† revisar antes de firmar</span>'}</div>
      </div>
    </div>`).join('');
  document.getElementById('firma-list-body').innerHTML = html;
  updateFirmaCount();
}

function toggleFirma(i) {
  firmas[i].checked = !firmas[i].checked;
  const el = document.getElementById('fcheck-'+i);
  el.classList.toggle('checked', firmas[i].checked);
  el.textContent = firmas[i].checked ? '‚úì' : '';
  updateFirmaCount();
}

function selectAllFirma() {
  firmas.forEach((_,i)=>{ firmas[i].checked=true; const el=document.getElementById('fcheck-'+i); el.classList.add('checked'); el.textContent='‚úì'; });
  updateFirmaCount();
}

function updateFirmaCount() {
  const n = firmas.filter(f=>f.checked).length;
  document.getElementById('firma-count').textContent = n===0?'0 seleccionados':`${n} seleccionado${n>1?'s':''}`;
}

function firmarTodo() {
  const n = firmas.filter(f=>f.checked).length;
  if(n===0){ alert('Selecciona al menos un documento.'); return; }
  document.getElementById('firma-list-body').innerHTML = `<div style="padding:40px 20px;text-align:center;color:var(--green);font-size:15px;font-weight:600">‚úì ${n} documento${n>1?'s':''} firmado${n>1?'s':''} correctamente</div>`;
  document.getElementById('firma-count').textContent = '‚úì Firmados';
}

function regenNota() {
  const ta = document.querySelectorAll('.nota-textarea')[1];
  ta.value = 'Regenerando con IA‚Ä¶';
  setTimeout(()=>{ ta.value = 'Paciente de 67 a√±os con HTA y DM2 conocidos, en seguimiento en atenci√≥n primaria. Acude a revisi√≥n programada. Refiere cumplimiento terap√©utico correcto. A la exploraci√≥n: TA 142/88 mmHg, FC 74 lpm, peso estable. Glucemia capilar 118 mg/dL. Sin edemas. Abdomen sin hallazgos. Sin dolor tor√°cico ni disnea de esfuerzo.'; }, 900);
}
</script>
</body>
</html>
